<!DOCTYPE html><html><head><meta name="viewport" content="maximum-scale=1,minimum-scale=1,user-scalable=0,width=device-width,initial-scale=1"><meta content="telephone=no" name="format-detection"><title>三级地址选择</title><link href="/css/app.css?i=1531590994144" rel="stylesheet"></head><body><div class="page-group"><div class="page page-current"><header class="api-nav"><a class="app-back">&lt;</a><h1>三级地址选择</h1></header><div style="padding:20px"><a class="weui-btn weui-btn_primary" id="addressView">点击选择地址</a></div></div></div><script src="/script/app.js?i=1531590994144"></script><script>api.ui.AddressView=function(){var i=this,s={};this.open=function(t){s.uiinit(t,function(){i.setSelect(t),s.isshow&&(s.isshow=!0,i.show()),s.isshow=!0})},this.setSelect=function(t){if(s.list.eq(0).html(s.template({list:s.data,selectid:t&&t.pro_id})).show(),t){var e=[];t.pro_id&&(e=s.getsub(s.data,t.pro_id))&&(s.title.eq(0).html(e.name).addClass("selected")[0].id=e.id,s.list.hide(),s.list.eq(1).html(s.template({list:e.sub,selectid:t.city_id})).show())||s.title.eq(0).text("请选择"),t.city_id&&e&&(e=s.getsub(e.sub,t.city_id))&&(s.title.removeClass("selected"),s.list.hide(),s.title.eq(1).html(e.name).addClass("selected")[0].id=e.id,s.title.eq(1).html(e.name),s.list.eq(2).html(s.template({list:e.sub,selectid:t.dir_id})).show())||"请选择"!==s.title.eq(0).text()&&s.title.eq(1).text("请选择"),t.dir_id&&e&&(e=s.getsub(e.sub,t.dir_id))&&(s.title.removeClass("selected"),s.title.eq(2).html(e.name).addClass("selected")[0].id=e.id,s.title.eq(2).html(e.name))||s.title.eq(1).text()&&"请选择"!==s.title.eq(1).text()&&s.title.eq(2).text("请选择")||s.title.eq(2).text(""),s.listtap()}},this.show=function(t,e){e&&(s.showfn=e),s.isshow&&(s.ui.show(),s.box.addClass("site-show")),s.isshow=!0},this.hide=function(){s.ui.hide(),s.ui.remove()},s.uiinit=function(t,e){return s.ui?e():(s.ui=$('<div class="addressView"><div class="site-box"><div class="ope-box"><label>所在地区</label><div class="xx"></div></div><div class="site-tetx"><span></span><span></span><span></span></div><ul class="site"></ul><ul class="site"></ul><ul class="site"></ul></div></div>').appendTo($(document.body)),s.box=s.ui.find(".site-box"),s.title=s.ui.find(".site-tetx span"),s.list=s.ui.find(".site"),api.page.enableTouchmove(s.list[0]),api.page.enableTouchmove(s.list[1]),api.page.enableTouchmove(s.list[2]),s.template=template.compile(""),s.loadData(t.file_addr,function(t){s.data=t,e&&e()}),s.title.tap(function(){s.title.removeClass("selected").eq($(this).index()).addClass("selected"),s.list.hide().eq($(this).index()).show()}),s.ui.tap(function(){i.hide()}),s.ui.find(".xx").tap(function(){i.hide()}),s.box.tap(function(t,e){return e.preventDefault(),!1}),!1)},s.getsub=function(t,e){for(var i=0;i<t.length;i++)if(t[i].id===e)return t[i];return null},s.setSelectPro=function(t){s.list.eq(0).html(s.template({list:s.data,selectid:t})).show(),s.selectPro=t&&s.getsub(s.data,t)||null},s.listtap=function(){s.list.eq(0).find("li").tap(function(){i.setSelect({pro_id:this.id})}),s.list.eq(1).find("li").tap(function(){i.setSelect({pro_id:s.title[0].id,city_id:this.id})}),s.list.eq(2).find("li").tap(function(){s.list.eq(2).find("li").removeClass("selected"),$(this).addClass("selected"),s.title.removeClass("selected"),s.title.eq(2).html($(this).text()).addClass("selected")[0].id=this.id,i.hide(),s.ok()})},s.ok=function(){var t=[{id:s.title.eq(0)[0].id,name:s.title.eq(0).text().replace(/ /g,"")},{id:s.title.eq(1)[0].id,name:s.title.eq(1).text().replace(/ /g,"")},{id:s.title.eq(2)[0].id,name:s.title.eq(2).text().replace(/ /g,"")}];s.showfn({status:!0,data:t})},s.loadData=function(t,e){api.ui.AddressView.data?e(api.ui.AddressView.data):$.ajax({url:t||"/res/district.json",type:"GET",dataType:"text/html",success:function(t){api.ui.AddressView.data=JSON.parse(t),e(api.ui.AddressView.data)},error:function(t){200===t.status&&(api.ui.AddressView.data=JSON.parse(t.responseText),e(api.ui.AddressView.data))}})}},$("#addressView").tap(function(){var t=new api.ui.AddressView,e=$(this).attr("data");e=e&&e.split(","),t.open({file_addr:"/res/district.json",selected_color:"#ff0000",pro_id:e&&e[0]||44e4,city_id:e&&e[1]||440300,dir_id:e&&e[2]||440304}),t.show({},function(t,e){if(t.status){var i=t.data[0].name+" "+t.data[1].name+" "+t.data[2].name,s=t.data[0].id+","+t.data[1].id+","+t.data[2].id;$("#addressView").html(i),$("#addressView").attr("data",s)}})})</script></body></html>